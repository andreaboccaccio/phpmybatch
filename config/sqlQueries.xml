<?xml version="1.0" encoding="UTF-8"?>
<!--
phpmywhs - An open source warehouse management software.
Copyright (C)2012 Andrea Boccaccio
contact email: andrea@andreaboccaccio.com

This file is part of phpmywhs.
 
phpmywhs is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

phpmywhs is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with phpmywhs.  If not, see <http://www.gnu.org/licenses/>.
 -->
<!DOCTYPE sqlQueries>
<sqlQueries>
	<sqlQuery id="itemsKindCodeName" displayName="Articoli Caricati per Categoria, Codice e Nome">
		<strSQL>
			SELECT kind AS Categoria
				,code AS Codice
				,name AS Nome
				,SUM(qty) AS QTA_Caricata
				FROM ITEM_DENORM
				GROUP BY kind
					,code
					,name
				ORDER BY kind
					,code
					,name
		</strSQL>
		<printInfo pageOrientation="P" unit="mm" pageSize="A4">
			<rowInfo headerHSize="7" bodyHSize="6" />
			<columnInfo sqlId="Categoria" wSize="40">
				<header display="Categoria" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="Codice" wSize="50">
				<header display="Codice" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="Nome" wSize="40">
				<header display="Nome" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="QTA_Caricata" wSize="35">
				<header display="QTA_Caricata" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
		</printInfo>
	</sqlQuery>
	<sqlQuery id="stocks" displayName="Giacenze per Categoria, Codice e Nome">
		<strSQL>
			SELECT ITEM_IN.Categoria AS Categoria
				,ITEM_IN.Codice AS Codice
				,ITEM_IN.Nome AS Nome
				,QTA_Caricata
				,IFNULL(QTA_Scaricata,0) AS QTA_Scaricata
				,(QTA_Caricata - IFNULL(QTA_Scaricata,0)) AS Giacenza
			FROM
			(
				SELECT kind AS Categoria
					,code AS Codice
					,name AS Nome
					,SUM(qty) AS QTA_Caricata
				FROM ITEM_DENORM
				GROUP BY kind
					,code
					,name
			) AS ITEM_IN
			LEFT JOIN
			(
				SELECT kind AS Categoria
					,code AS Codice
					,name AS Nome
					,SUM(qty) AS QTA_Scaricata
				FROM ITEM_OUT
				GROUP BY kind
					,code
					,name
			) AS ITEM_OUT
			ON
			(
				(ITEM_IN.Categoria = ITEM_OUT.Categoria)
				AND (ITEM_IN.Codice = ITEM_OUT.Codice)
				AND (ITEM_IN.Nome = ITEM_OUT.Nome)
			)
			ORDER BY ITEM_IN.Categoria
				,ITEM_IN.Codice
				,ITEM_IN.Nome
		</strSQL>
		<printInfo pageOrientation="L" unit="mm" pageSize="A4">
			<rowInfo headerHSize="7" bodyHSize="6" />
			<columnInfo sqlId="Categoria" wSize="40">
				<header display="Categoria" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="Codice" wSize="50">
				<header display="Codice" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="Nome" wSize="40">
				<header display="Nome" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="QTA_Caricata" wSize="35">
				<header display="QTA_Caricata" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
			<columnInfo sqlId="QTA_Scaricata" wSize="35">
				<header display="QTA_Scaricata" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
			<columnInfo sqlId="Giacenza" wSize="30">
				<header display="Giacenza" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
		</printInfo>
	</sqlQuery>
	<sqlQuery id="suppliers" displayName="Fornitori">
		<strSQL>
			SELECT contractor_code AS PIVA
				,contractor AS fornitore
				FROM DOCUMENT_DENORM
				GROUP BY contractor_code
					,contractor
		</strSQL>
		<printInfo  pageOrientation="P" unit="mm" pageSize="A4">
			<rowInfo headerHSize="7" bodyHSize="6" />
			<columnInfo sqlId="PIVA" wSize="40">
				<header display="PIVA" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="fornitore" wSize="40">
				<header display="fornitore" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
		</printInfo>
	</sqlQuery>
	<wizard id="newBatch" displayName="Lotti non ancora commercializzati">
		<strSQL>
			SELECT
				LottoEntrato AS Lotto
				,CONCAT(SUBSTRING(I.MinDate,7,2),'/',SUBSTRING(I.MinDate,5,2),'/',SUBSTRING(I.MinDate,1,4)) AS DataArrivo
			FROM
			(
				SELECT
					batch AS LottoEntrato
					,CAST(MIN(CAST(CONCAT(SUBSTRING(arrival,7,4),SUBSTRING(arrival,4,2),SUBSTRING(arrival,1,2)) AS UNSIGNED INTEGER)) AS CHAR) AS MinDate
				FROM ITEM_DENORM
				GROUP BY
					batch
			)AS I
			LEFT OUTER JOIN
			(
				SELECT
					batch AS LottoUscita
				FROM BATCH
				GROUP BY
					batch
			)AS O
			ON
			(I.LottoEntrato=O.LottoUscita)
			WHERE
			(
				(LottoUscita IS NULL)
			)
		</strSQL>
		<fieldsMapping>
			<insView id="batchNew"/>
			<fieldMapping sql="Lotto" viewInsert="batch"/>
		</fieldsMapping>
		<fieldsView>
			<fieldView sql="Lotto" viewField="Lotto"/>
			<fieldView sql="DataArrivo" viewField="DataArrivo"/>
		</fieldsView>
		<fieldsFilter>
			<fieldFilter sql="Lotto" filterField="batch"/>
		</fieldsFilter>
	</wizard>
	<wizard id="newItemIn" displayName="Lotti immessi nel sistema">
		<strSQL>
			SELECT
				Fornitore
				,Nazione
				,Dipartimento
				,NStabCEE
				,Lotto
				,Categoria
				,Colli
				,kg
				,DataArrivo
				,country
			FROM
				(
					SELECT
						kind AS Categoria
						,batch AS Lotto
						,country
						,district AS Dipartimento
						,stabCEE AS NStabCEE
						,qty AS Colli
						,kg
						,arrival AS DataArrivo
						,document
					 FROM ITEM_DENORM
				) AS L
				INNER JOIN
				(
					SELECT
						id AS countryID
						,codealpha2 AS Nazione
					FROM COUNTRY
				) AS C
				ON
				(L.country = C.countryID)
				INNER JOIN
				(
					SELECT
						id
						,contractor AS Fornitore
					FROM DOCUMENT_DENORM
				)AS D
				ON
				(L.document = D.id)
				ORDER BY
					Fornitore
					,Nazione
					,Dipartimento
					,NStabCEE
					,Categoria
					,DataArrivo
		</strSQL>
		<fieldsMapping>
			<insView id="itemNew"/>
			<fieldMapping sql="country" viewInsert="country"/>
			<fieldMapping sql="Dipartimento" viewInsert="district"/>
			<fieldMapping sql="NStabCEE" viewInsert="stabCEE"/>
			<fieldMapping sql="Lotto" viewInsert="batch"/>
			<fieldMapping sql="Categoria" viewInsert="kind"/>
			<fieldMapping sql="Colli" viewInsert="qty"/>
			<fieldMapping sql="kg" viewInsert="kg"/>
		</fieldsMapping>
		<fieldsView>
			<fieldView sql="Fornitore" viewField="Fornitore"/>
			<fieldView sql="Nazione" viewField="Nazione"/>
			<fieldView sql="Dipartimento" viewField="Dipartimento"/>
			<fieldView sql="NStabCEE" viewField="NStabCEE"/>
			<fieldView sql="Lotto" viewField="batch"/>
			<fieldView sql="DataArrivo" viewField="DataArrivo"/>
			<fieldView sql="Categoria" viewField="kind"/>
		</fieldsView>
		<fieldsFilter>
			<fieldFilter sql="Fornitore" filterField="Fornitore"/>
			<fieldFilter sql="Nazione" filterField="Nazione"/>
			<fieldFilter sql="Dipartimento" filterField="Dipartimento"/>
			<fieldFilter sql="NStabCEE" filterField="NStabCEE"/>
			<fieldFilter sql="Lotto" filterField="batch"/>
			<fieldFilter sql="Categoria" filterField="kind"/>
		</fieldsFilter>
	</wizard>
</sqlQueries>