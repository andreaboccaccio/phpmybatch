<?xml version="1.0" encoding="UTF-8"?>
<!--
phpmywhs - An open source warehouse management software.
Copyright (C)2012 Andrea Boccaccio
contact email: andrea@andreaboccaccio.com

This file is part of phpmywhs.
 
phpmywhs is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

phpmywhs is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with phpmywhs.  If not, see <http://www.gnu.org/licenses/>.
 -->
<!DOCTYPE sqlQueries>
<sqlQueries>
	<sqlQuery id="itemsKindCodeName" displayName="Articoli Caricati per Categoria, Codice e Nome">
		<strSQL>
			SELECT kind AS Categoria
				,code AS Codice
				,name AS Nome
				,SUM(qty) AS QTA_Caricata
				FROM ITEM_DENORM
				GROUP BY kind
					,code
					,name
				ORDER BY kind
					,code
					,name
		</strSQL>
	</sqlQuery>
	<sqlQuery id="stocks" displayName="Giacenze per Categoria, Codice e Nome">
		<strSQL>
			SELECT ITEM_IN.Categoria AS Categoria
				,ITEM_IN.Codice AS Codice
				,ITEM_IN.Nome AS Nome
				,QTA_Caricata
				,IFNULL(QTA_Scaricata,0) AS QTA_Scaricata
				,(QTA_Caricata - IFNULL(QTA_Scaricata,0)) AS Giacenza
			FROM
			(
				SELECT kind AS Categoria
					,code AS Codice
					,name AS Nome
					,SUM(qty) AS QTA_Caricata
				FROM ITEM_DENORM
				GROUP BY kind
					,code
					,name
			) AS ITEM_IN
			LEFT JOIN
			(
				SELECT kind AS Categoria
					,code AS Codice
					,name AS Nome
					,SUM(qty) AS QTA_Scaricata
				FROM ITEM_OUT
				GROUP BY kind
					,code
					,name
			) AS ITEM_OUT
			ON
			(
				(ITEM_IN.Categoria = ITEM_OUT.Categoria)
				AND (ITEM_IN.Codice = ITEM_OUT.Codice)
				AND (ITEM_IN.Nome = ITEM_OUT.Nome)
			)
			ORDER BY ITEM_IN.Categoria
				,ITEM_IN.Codice
				,ITEM_IN.Nome
		</strSQL>
	</sqlQuery>
	<sqlQuery id="suppliers" displayName="Fornitori">
		<strSQL>
			SELECT contractor_code AS PIVA
				,contractor AS fornitore
				FROM DOCUMENT_DENORM
				GROUP BY contractor_code
					,contractor
		</strSQL>
	</sqlQuery>
	<wizard id="newItemOut" displayName="Articoli con giacenze attive">
		<strSQL>
			SELECT ITEM_IN.Categoria AS Categoria
				,ITEM_IN.Codice AS Codice
				,ITEM_IN.Nome AS Nome
				,QTA_Caricata
				,IFNULL(QTA_Scaricata,0) AS QTA_Scaricata
				,(QTA_Caricata - IFNULL(QTA_Scaricata,0)) AS Giacenza
			FROM
			(
				SELECT kind AS Categoria
					,code AS Codice
					,name AS Nome
					,SUM(qty) AS QTA_Caricata
				FROM ITEM_DENORM
				GROUP BY kind
					,code
					,name
			) AS ITEM_IN
			LEFT JOIN
			(
				SELECT kind AS Categoria
					,code AS Codice
					,name AS Nome
					,SUM(qty) AS QTA_Scaricata
				FROM ITEM_OUT
				GROUP BY kind
					,code
					,name
			) AS ITEM_OUT
			ON
			(
				(ITEM_IN.Categoria = ITEM_OUT.Categoria)
				AND (ITEM_IN.Codice = ITEM_OUT.Codice)
				AND (ITEM_IN.Nome = ITEM_OUT.Nome)
			)
			WHERE ((QTA_Caricata - IFNULL(QTA_Scaricata,0)) > 0)
		</strSQL>
		<fieldsMapping>
			<fieldMapping sql="Categoria" viewInsert="kind"/>
			<fieldMapping sql="Codice" viewInsert="code"/>
			<fieldMapping sql="Nome" viewInsert="name"/>
		</fieldsMapping>
	</wizard>
</sqlQueries>