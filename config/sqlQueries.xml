<?xml version="1.0" encoding="UTF-8"?>
<!--
phpmybatch - An open source batches of goods management system software.
Copyright (C)2012 Andrea Boccaccio
contact email: andrea@andreaboccaccio.com

This file is part of phpmybatch.
 
phpmybatch is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

phpmybatch is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with phpmywhs.  If not, see <http://www.gnu.org/licenses/>.
 -->
<!DOCTYPE sqlQueries>
<sqlQueries>
	<sqlQuery id="ldBatch" displayName="Registro Carico e Identificazione dei Lotti">
		<strSQL>
			SELECT
				Data
				,FattN AS FatturaNumero
				,Nazione
				,LottoMacellazione
				,LottoEntrato AS Lotto
			FROM
			(
				SELECT
					batch AS LottoEntrato
					,batch_orig AS LottoMacellazione
					,country
					,document
				FROM ITEM_DENORM
			)AS I
			INNER JOIN
			(
				SELECT
					id AS docID
					,doc_date AS Data
					,code AS FattN
				FROM DOCUMENT_DENORM
			)AS D
			ON
			(I.document=D.docID)
			INNER JOIN
			(
				SELECT
					id AS countryID
					,codealpha2 AS Nazione
				FROM
					COUNTRY
			)AS C
			ON
			(I.country = C.countryID)
		</strSQL>
		<printInfo pageOrientation="P" unit="mm" pageSize="A4">
			<rowInfo headerHSize="7" bodyHSize="6" />
			<columnInfo sqlId="Data" wSize="30">
				<header display="Data" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="FatturaNumero" wSize="30">
				<header display="FATT N" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="Nazione" wSize="25">
				<header display="Nazione" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="LottoMacellazione" wSize="50">
				<header display="Lotto Macellazione" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
			<columnInfo sqlId="Lotto" wSize="30">
				<header display="Lotto" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
		</printInfo>
	</sqlQuery>
	<sqlQuery id="ldUnldMeat" displayName="Registro Carico e Scarico delle Carni Bovine">
		<strSQL>
			SELECT
				LottoEntrato AS Lotto
				,CONCAT(SUBSTRING(I.MinDate,7,2),'/',SUBSTRING(I.MinDate,5,2),'/',SUBSTRING(I.MinDate,1,4)) AS DataArrivo
				,REPLACE(CAST( qta AS CHAR),'.',',') AS quantita
				,IFNULL(dic,'') AS DataInizioComm
				,IFNULL(dfc,'') AS DataFineComm
			FROM
			(
				SELECT
					batch AS LottoEntrato
					,CAST(MIN(CAST(CONCAT(SUBSTRING(arrival,7,4),SUBSTRING(arrival,4,2),SUBSTRING(arrival,1,2)) AS UNSIGNED INTEGER)) AS CHAR) AS MinDate
					,SUM(kg) AS qta
				FROM ITEM_DENORM
				GROUP BY
					batch
			)AS I
			LEFT OUTER JOIN
			(
				SELECT
					batch AS LottoUscita
					,vt_start AS dic
					,vt_end AS dfc
				FROM BATCH
				GROUP BY
					batch
			)AS O
			ON
			(I.LottoEntrato=O.LottoUscita)
		</strSQL>
		<printInfo pageOrientation="P" unit="mm" pageSize="A4">
			<rowInfo headerHSize="7" bodyHSize="6" />
			<columnInfo sqlId="Lotto" wSize="30">
				<header display="Lotto" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="DataArrivo" wSize="30">
				<header display="Data arrivo" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="quantita" wSize="30">
				<header display="quantita'" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="DataInizioComm" wSize="43">
				<header display="Data inizio comm." fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
			<columnInfo sqlId="DataFineComm" wSize="43">
				<header display="Data fine comm." fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
		</printInfo>
	</sqlQuery>
	<sqlQuery id="monthlyPro" displayName="Prospetto mensile dei controlli documentali">
		<strSQL>
			SELECT
				FattN AS Numero
				,Data
				,Fornitore AS RilasciatoA
				,Nazione AS StatoOrigine
				,district AS Dipartimento
				,stabCEE AS NstabCEE
				,TipoProdotto
				,Colli
				,Kg
				,'' AS DataControllo
				,'' AS Esito
			FROM
			(
				SELECT
					country
					,district
					,stabCEE
					,kind AS TipoProdotto
					,qty AS Colli
					,kg AS Kg
					,document
				FROM ITEM_DENORM
			)AS I
			INNER JOIN
			(
				SELECT
					id AS docID
					,doc_date AS Data
					,code AS FattN
					,contractor AS Fornitore
				FROM DOCUMENT_DENORM
			)AS D
			ON
			(I.document=D.docID)
			INNER JOIN
			(
				SELECT
					id AS countryID
					,codealpha2 AS Nazione
				FROM
					COUNTRY
				WHERE
				(
					(codealpha2 != 'IT')
				)
			)AS C
			ON
			(I.country = C.countryID)
		</strSQL>
		<printInfo pageOrientation="L" unit="mm" pageSize="A4">
			<rowInfo headerHSize="7" bodyHSize="6" />
			<columnInfo sqlId="Numero" wSize="20">
				<header display="Numero" fontFamily="Helvetica" fontStyle="B"
					fontSize="10" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="8" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="Data" wSize="20">
				<header display="Data" fontFamily="Helvetica" fontStyle="B"
					fontSize="10" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="8" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="RilasciatoA" wSize="25">
				<header display="Rilasciato a" fontFamily="Helvetica" fontStyle="B"
					fontSize="10" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="8" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="StatoOrigine" wSize="30">
				<header display="Stato di origine" fontFamily="Helvetica" fontStyle="B"
					fontSize="10" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="8" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
			<columnInfo sqlId="Dipartimento" wSize="33">
				<header display="Dipartimento prov." fontFamily="Helvetica" fontStyle="B"
					fontSize="10" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="8" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
			<columnInfo sqlId="NstabCEE" wSize="30">
				<header display="N. stab. CEE" fontFamily="Helvetica" fontStyle="B"
					fontSize="10" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="8" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
			<columnInfo sqlId="TipoProdotto" wSize="30">
				<header display="Tipo prodotto" fontFamily="Helvetica" fontStyle="B"
					fontSize="10" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="8" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
			<columnInfo sqlId="Colli" wSize="20">
				<header display="Colli" fontFamily="Helvetica" fontStyle="B"
					fontSize="10" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="8" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
			<columnInfo sqlId="Kg" wSize="20">
				<header display="Kg" fontFamily="Helvetica" fontStyle="B"
					fontSize="10" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="8" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
			<columnInfo sqlId="DataControllo" wSize="30">
				<header display="Data controllo id." fontFamily="Helvetica" fontStyle="B"
					fontSize="10" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="8" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
			<columnInfo sqlId="Esito" wSize="15">
				<header display="Esito" fontFamily="Helvetica" fontStyle="B"
					fontSize="10" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="8" align="R"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="integer" />
			</columnInfo>
		</printInfo>
	</sqlQuery>
	<sqlQuery id="suppliers" displayName="Fornitori">
		<strSQL>
			SELECT contractor_code AS PIVA
				,contractor AS fornitore
				FROM DOCUMENT_DENORM
				GROUP BY contractor_code
					,contractor
		</strSQL>
		<printInfo  pageOrientation="P" unit="mm" pageSize="A4">
			<rowInfo headerHSize="7" bodyHSize="6" />
			<columnInfo sqlId="PIVA" wSize="40">
				<header display="PIVA" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
			<columnInfo sqlId="fornitore" wSize="40">
				<header display="fornitore" fontFamily="Helvetica" fontStyle="B"
					fontSize="14" align="C"	textColor="0,0,0" fill="enabled"
					fillColor="255,255,255"	border="LTRB" />
				<body fontFamily="Times" fontStyle="" fontSize="12" align="L"
					textColor="0,0,0" fill="enabled" fillAColor="200,200,200"
					fillBColor="255,255,255" border="LR" format="text" />
			</columnInfo>
		</printInfo>
	</sqlQuery>
	<wizard id="newBatch" displayName="Lotti non ancora commercializzati">
		<strSQL>
			SELECT
				LottoEntrato AS Lotto
				,CONCAT(SUBSTRING(I.MinDate,7,2),'/',SUBSTRING(I.MinDate,5,2),'/',SUBSTRING(I.MinDate,1,4)) AS DataArrivo
			FROM
			(
				SELECT
					batch AS LottoEntrato
					,CAST(MIN(CAST(CONCAT(SUBSTRING(arrival,7,4),SUBSTRING(arrival,4,2),SUBSTRING(arrival,1,2)) AS UNSIGNED INTEGER)) AS CHAR) AS MinDate
				FROM ITEM_DENORM
				GROUP BY
					batch
			)AS I
			LEFT OUTER JOIN
			(
				SELECT
					batch AS LottoUscita
				FROM BATCH
				GROUP BY
					batch
			)AS O
			ON
			(I.LottoEntrato=O.LottoUscita)
			WHERE
			(
				(LottoUscita IS NULL)
			)
		</strSQL>
		<fieldsMapping>
			<insView id="batchNew"/>
			<fieldMapping sql="Lotto" viewInsert="batch"/>
		</fieldsMapping>
		<fieldsView>
			<fieldView sql="Lotto" viewField="Lotto"/>
			<fieldView sql="DataArrivo" viewField="DataArrivo"/>
		</fieldsView>
		<fieldsFilter>
			<fieldFilter sql="Lotto" filterField="batch"/>
		</fieldsFilter>
	</wizard>
	<wizard id="newItemIn" displayName="Lotti immessi nel sistema">
		<strSQL>
			SELECT
				Fornitore
				,Nazione
				,Dipartimento
				,NStabCEE
				,Lotto
				,Categoria
				,Colli
				,kg
				,DataArrivo
				,country
			FROM
				(
					SELECT
						kind AS Categoria
						,batch AS Lotto
						,country
						,district AS Dipartimento
						,stabCEE AS NStabCEE
						,qty AS Colli
						,kg
						,arrival AS DataArrivo
						,document
					 FROM ITEM_DENORM
				) AS L
				INNER JOIN
				(
					SELECT
						id AS countryID
						,codealpha2 AS Nazione
					FROM COUNTRY
				) AS C
				ON
				(L.country = C.countryID)
				INNER JOIN
				(
					SELECT
						id
						,contractor AS Fornitore
					FROM DOCUMENT_DENORM
				)AS D
				ON
				(L.document = D.id)
				ORDER BY
					Fornitore
					,Nazione
					,Dipartimento
					,NStabCEE
					,Categoria
					,DataArrivo
		</strSQL>
		<fieldsMapping>
			<insView id="itemNew"/>
			<fieldMapping sql="country" viewInsert="country"/>
			<fieldMapping sql="Dipartimento" viewInsert="district"/>
			<fieldMapping sql="NStabCEE" viewInsert="stabCEE"/>
			<fieldMapping sql="Lotto" viewInsert="batch"/>
			<fieldMapping sql="Categoria" viewInsert="kind"/>
			<fieldMapping sql="Colli" viewInsert="qty"/>
			<fieldMapping sql="kg" viewInsert="kg"/>
		</fieldsMapping>
		<fieldsView>
			<fieldView sql="Fornitore" viewField="Fornitore"/>
			<fieldView sql="Nazione" viewField="Nazione"/>
			<fieldView sql="Dipartimento" viewField="Dipartimento"/>
			<fieldView sql="NStabCEE" viewField="NStabCEE"/>
			<fieldView sql="Lotto" viewField="batch"/>
			<fieldView sql="DataArrivo" viewField="DataArrivo"/>
			<fieldView sql="Categoria" viewField="kind"/>
		</fieldsView>
		<fieldsFilter>
			<fieldFilter sql="Fornitore" filterField="Fornitore"/>
			<fieldFilter sql="Nazione" filterField="Nazione"/>
			<fieldFilter sql="Dipartimento" filterField="Dipartimento"/>
			<fieldFilter sql="NStabCEE" filterField="NStabCEE"/>
			<fieldFilter sql="Lotto" filterField="batch"/>
			<fieldFilter sql="Categoria" filterField="kind"/>
		</fieldsFilter>
	</wizard>
</sqlQueries>